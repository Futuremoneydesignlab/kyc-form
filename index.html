<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>完全統合申込フォーム</title>
<style>
:root {
  --primary-color: #2c3e50;
  --secondary-color: #3498db;
  --error-color: #e74c3c;
  --success-color: #27ae60;
  --text-color: #34495e;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  background: #ecf0f1;
  color: var(--text-color);
  line-height: 1.6;
}

header {
  background: var(--primary-color);
  color: white;
  padding: 1rem;
  position: sticky;
  top: 0;
  z-index: 1000;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.container {
  max-width: 800px;
  margin: 2rem auto;
  padding: 0 1rem;
}

.progress-container {
  height: 8px;
  background: #bdc3c7;
  border-radius: 4px;
  margin: 1.5rem 0;
}

.progress-bar {
  height: 100%;
  background: var(--secondary-color);
  transition: width 0.3s ease;
}

.step {
  background: white;
  padding: 2rem;
  border-radius: 10px;
  box-shadow: 0 2px 15px rgba(0,0,0,0.05);
  margin-bottom: 1.5rem;
  display: none;
}

.step.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

label {
  display: block;
  margin: 1rem 0 0.5rem;
  font-weight: 500;
}

input, select, textarea {
  width: 100%;
  padding: 0.8rem;
  border: 2px solid #bdc3c7;
  border-radius: 6px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

input:focus, select:focus, textarea:focus {
  border-color: var(--secondary-color);
  outline: none;
  box-shadow: 0 0 8px rgba(52, 152, 219, 0.2);
}

.button-group {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
}

button {
  flex: 1;
  padding: 1rem;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.prev-btn {
  background: #95a5a6;
  color: white;
}

.next-btn {
  background: var(--secondary-color);
  color: white;
}

button[type="submit"] {
  background: var(--success-color);
}

.error-message {
  color: var(--error-color);
  font-size: 0.9em;
  margin-top: 0.5rem;
  display: none;
}

.network-status {
  position: fixed;
  bottom: 1rem;
  right: 1rem;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  color: white;
  font-size: 0.9em;
  display: none;
  z-index: 1000;
}

.online { background: var(--success-color); }
.offline { background: var(--error-color); }

.success-message {
  background: #e0ffe0;
  color: #006600;
  padding: 20px;
  border-radius: 8px;
  margin-top: 30px;
  font-size: 16px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 480px) {
  .container { padding: 0 0.5rem; }
  .step { padding: 1rem; }
  button { padding: 0.8rem; }
}
</style>
<script src="https://www.google.com/recaptcha/api.js?render=6Ldt9BwrAAAAAFcxv593i86WyBKetcwrGdWecK09"></script>
</head>
<body>
<header>
  <h1>STEP <span id="current-step">1</span>/8</h1>
  <div class="progress-container"><div class="progress-bar"></div></div>
</header>

<div class="container">
  <form id="mainForm">
     <!-- STEP 1 -->
    <div class="step active" id="step1">
      <h2>STEP1｜基本情報の入力</h2>
      <label>担当者名<input type="text" name="staff" required></label>
      <label>紹介コード<input type="text" name="ref_code"></label>
      <label>申込日<input type="date" name="apply_date" required></label>
      <label>名<input type="text" name="first_name" required></label>
      <label>姓<input type="text" name="last_name" required></label>
      <label>メイ（カナ）<input type="text" name="first_kana"></label>
      <label>セイ（カナ）<input type="text" name="last_kana"></label>
      <label>性別<select name="gender" required><option value="">選択</option><option>男性</option><option>女性</option><option>その他</option></select></label>
      <label>生年月日<input type="date" name="birth" required></label>
      <label>電話番号<input type="tel" name="phone" required></label>
      <label>メールアドレス<input type="email" name="email" required></label>
      <label>郵便番号<input type="text" name="postcode" onblur="lookupAddress()" required></label>
      <label>都道府県<input type="text" name="prefecture" required></label>
      <label>市区町村<input type="text" name="city" required></label>
      <label>番地<input type="text" name="street" required></label>
      <label>建物名<input type="text" name="building"></label>
      <div class="button-group"><button type="button" class="next-btn" onclick="nextStep()">次へ</button></div>
    </div>

    <!-- STEP 2 -->
    <div class="step" id="step2">
      <h2>STEP2｜本人確認情報</h2>
      <label>身分証の種類<select name="id_type" required><option value="">選択</option><option>パスポート</option><option>運転免許証</option><option>マイナンバーカード</option><option>在留カード</option></select></label>
      <label>身分証番号<input type="text" name="id_number" required></label>
      <label>発行日<input type="date" name="id_issue_date" required></label>
      <label>有効期限<input type="date" name="id_expiry_date" required></label>
      <label>マイナンバー<input type="text" name="my_number"></label>
      <label>身分証明書（表）<input type="file" name="id_front" accept="image/*"></label>
      <label>身分証明書（裏）<input type="file" name="id_back" accept="image/*"></label>
<label>住居証明書（表）<input type="file" name="residence_proof_front" accept="image/*,application/pdf"></label>
<label>住居証明書（裏）<input type="file" name="residence_proof_back" accept="image/*,application/pdf"></label>
<p style="font-size: 0.85em; color: #555; margin-top: 20px;">
  ご提出いただく書類データ（身分証・住居証明等）は、個人情報保護法および関連法令に基づき、厳重に管理いたします。<br>
  当フォームはSSL暗号化通信により保護されており、収集されたデータは本人確認・所定の審査目的にのみ使用され、目的外の利用・第三者提供は一切行いません。
</p>

      <div class="button-group"><button type="button" class="prev-btn" onclick="prevStep()">戻る</button><button type="button" class="next-btn" onclick="nextStep()">次へ</button></div>
    </div>

    <!-- STEP 3 -->
<div class="step" id="step3">
  <h2>STEP3｜勤務情報と資産背景</h2>

  <label>勤務先名
    <input type="text" name="employer_name" required>
  </label>

  <label>職業（業種）
    <select name="job_industry" required>
      <option value="">選択してください</option>
      <option>金融・保険</option>
      <option>IT・通信</option>
      <option>医療・福祉</option>
      <option>建設・不動産</option>
      <option>製造・工業</option>
      <option>運輸・物流</option>
      <option>販売・サービス</option>
      <option>公務員</option>
      <option>その他</option>
    </select>
  </label>

  <label>職業（役職）
    <select name="job_position" required>
      <option value="">選択してください</option>
      <option>一般社員</option>
      <option>主任・係長</option>
      <option>課長・部長</option>
      <option>役員</option>
      <option>自営業</option>
      <option>無職</option>
      <option>その他</option>
    </select>
  </label>

  <label>勤務先 郵便番号
    <input type="text" name="employer_postcode" maxlength="7">
  </label>

  <label>勤務先 都道府県
    <input type="text" name="employer_prefecture">
  </label>

  <label>勤務先 市区町村
    <input type="text" name="employer_city">
  </label>

  <label>勤務先 番地
    <input type="text" name="employer_street">
  </label>

  <label>勤務先 建物名
    <input type="text" name="employer_building">
  </label>

  <label>年収（万円）
    <input type="number" name="income" required>
  </label>

  <label>勤続年数（年）
    <input type="number" name="years_of_service" required>
  </label>

  <label>資金調達方法
    <select name="fund_source" required>
      <option value="">選択してください</option>
      <option>給与所得</option>
      <option>事業所得</option>
      <option>不動産所得</option>
      <option>相続・贈与</option>
      <option>投資収益</option>
      <option>退職金</option>
      <option>その他</option>
    </select>
  </label>

  <div class="button-group">
    <button type="button" class="prev-btn" onclick="prevStep()">戻る</button>
    <button type="button" class="next-btn" onclick="nextStep()">次へ</button>
  </div>
</div>

<!-- STEP 4 -->
<div class="step" id="step4">
  <h2>STEP4｜投資内容・契約条件</h2>

  <label>投資プラン
    <select name="investment_plan" required>
      <option value="">選択してください</option>
      <option value="エボリューション">エボリューション</option>
      <option value="S&P500">S&P500</option>
      <option value="プラチナプラン">プラチナプラン</option>
      <option value="確定利回りポートフォリオ">確定利回りポートフォリオ</option>
      <option value="その他">その他</option>
    </select>
  </label>

  <label>投資期間（年）
    <input type="number" name="investment_period" min="1" max="25" required>
  </label>

  <label>年間（一括）拠出額（USD）
    <input type="number" name="annual_amount" required>
  </label>

  <label>通貨
    <select name="currency" required>
      <option value="">選択してください</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
      <option value="GBP">GBP</option>
    </select>
  </label>

  <label>支払頻度
    <select name="payment_frequency" required>
      <option value="">選択してください</option>
      <option value="年1回">年1回</option>
      <option value="半年ごと">半年ごと</option>
      <option value="四半期ごと">四半期ごと</option>
      <option value="毎月">毎月</option>
    </select>
  </label>

  <label>支払方法
    <select name="payment_method" required>
      <option value="">選択してください</option>
      <option value="クレジットカード">クレジットカード</option>
      <option value="銀行振込">銀行振込</option>
    </select>
  </label>

  <label>カード種類（※カード払いの場合）
    <select name="card_type">
      <option value="">選択してください</option>
      <option value="VISA">VISA</option>
      <option value="MasterCard">MasterCard</option>
      <option value="AMEX">AMEX</option>
      <option value="JCB">JCB</option>
    </select>
  </label>

  <label>カード番号（※カード払いの場合）
    <input type="text" name="card_number" maxlength="19">
  </label>

  <label>カード有効期限（MM/YY）
    <input type="text" name="card_expiry" placeholder="MM/YY">
  </label>

  <div class="button-group">
    <button type="button" class="prev-btn" onclick="prevStep()">戻る</button>
    <button type="button" class="next-btn" onclick="nextStep()">次へ</button>
  </div>
</div>

<!-- STEP 5 -->
<div class="step" id="step5">
  <h2>STEP5｜銀行情報・支払元確認</h2>

  <label>銀行名
    <input type="text" name="bank_name" required>
  </label>

  <label>支店名または支店番号
    <input type="text" name="branch_name" required>
  </label>

  <label>口座開設日
    <input type="date" name="account_open_date">
  </label>

  <label>口座名義（カタカナ）
    <input type="text" name="account_holder_kana" required>
  </label>

  <label>口座番号
    <input type="text" name="account_number" required>
  </label>

  <label>年収（資金額）
    <input type="number" name="account_income" required>
  </label>

  <div class="button-group">
    <button type="button" class="prev-btn" onclick="prevStep()">戻る</button>
    <button type="button" class="next-btn" onclick="nextStep()">次へ</button>
  </div>
</div>

<!-- STEP 6 -->
<div class="step" id="step6">
  <h2>STEP6｜受益者情報（任意）</h2>

  <label>受益者氏名（名）
    <input type="text" name="beneficiary_first_name">
  </label>

  <label>受益者氏名（姓）
    <input type="text" name="beneficiary_last_name">
  </label>

  <label>受益者フリガナ（メイ）
    <input type="text" name="beneficiary_first_kana">
  </label>

  <label>受益者フリガナ（セイ）
    <input type="text" name="beneficiary_last_kana">
  </label>

  <label>性別
    <select name="beneficiary_gender">
      <option value="">選択してください</option>
      <option value="男性">男性</option>
      <option value="女性">女性</option>
      <option value="その他">その他</option>
    </select>
  </label>

  <label>生年月日
    <input type="date" name="beneficiary_birth">
  </label>

  <label>あなたとの関係
    <select name="beneficiary_relation">
      <option value="">選択してください</option>
      <option value="配偶者">配偶者</option>
      <option value="子">子</option>
      <option value="親">親</option>
      <option value="兄弟姉妹">兄弟姉妹</option>
      <option value="その他">その他</option>
    </select>
  </label>

  <div class="button-group">
    <button type="button" class="prev-btn" onclick="prevStep()">戻る</button>
    <button type="button" class="next-btn" onclick="nextStep()">次へ</button>
  </div>
</div>

<!-- STEP 7 -->
<div class="step" id="step7">
  <h2>STEP7｜医療・米国情報・PEPs確認</h2>

  <label>1. 保険申込・査定で拒否または延期されたことはありますか？
    <select name="q1_medical_decline" required>
      <option value="">選択してください</option>
      <option value="はい">はい</option>
      <option value="いいえ">いいえ</option>
    </select>
  </label>

  <label>2. 以下の病気に罹患・治療歴がありますか？<br>（心臓・脳卒中・高血圧・腫瘍・癌・糖尿病など）
    <select name="q2_serious_disease" required>
      <option value="">選択してください</option>
      <option value="はい">はい</option>
      <option value="いいえ">いいえ</option>
    </select>
  </label>

  <label>3. エイズまたはその関連症状の診断・治療歴はありますか？
    <select name="q3_aids" required>
      <option value="">選択してください</option>
      <option value="はい">はい</option>
      <option value="いいえ">いいえ</option>
    </select>
  </label>

  <label>4. 危険なスポーツや活動に参加したことがありますか？または参加予定がありますか？<br>（例：スカイダイビング、自動車レース等）
    <select name="q4_danger_sports" required>
      <option value="">選択してください</option>
      <option value="はい">はい</option>
      <option value="いいえ">いいえ</option>
    </select>
  </label>

  <label>※ 上記のいずれかに「はい」と答えた場合は、かかりつけ医師の情報を記入してください。
    <textarea name="doctor_contact" placeholder="氏名・住所・電話番号・FAXなど"></textarea>
  </label>

  <label>あなたは米国市民、または税務上の米国居住者ですか？
    <select name="us_tax_resident" required>
      <option value="">選択してください</option>
      <option value="はい">はい</option>
      <option value="いいえ">いいえ</option>
    </select>
  </label>

  <label>政府・国家元首・政治的に影響力のある人物またはその家族に該当しますか？
    <select name="pep_status" required>
      <option value="">選択してください</option>
      <option value="はい">はい</option>
      <option value="いいえ">いいえ</option>
    </select>
  </label>

  <div class="button-group">
    <button type="button" class="prev-btn" onclick="prevStep()">戻る</button>
    <button type="button" class="next-btn" onclick="nextStep()">次へ</button>
  </div>
</div>


<!-- STEP 8 -->
<div class="step" id="step8">
  <h2>STEP8｜利用規約・同意・送信確認</h2>

  <div class="terms-box" style="margin-bottom: 20px; line-height: 1.8;">
    <h3>＜個人情報保護方針＞</h3>
    <ul>
      <li>1. 本申込書にていただいた個人情報は、申込とお取引いただいた会社のアフターサービス・ご案内にのみ使用します。</li>
      <li>2. 本申込書にていただいた個人情報は、適正に管理・保護し、目的以外の利用や第三者への情報提供は行いません。</li>
      <li>3. いただいた個人情報の照会、修正、削除については、担当者にお問い合わせください。</li>
    </ul>

    <h3 style="margin-top: 20px;">＜宣誓＞</h3>
    <ul>
      <li>1. 私は、自主的にITA International Holdingsが販売する商品へ投資することを確認いたします。</li>
      <li>2. 私は、契約書作成に伴う上記個人情報の転記等を了解いたします。</li>
      <li>3. 私は、このフォームに記載した情報には不備がなく、虚偽がないことを宣誓します。</li>
      <li>不備または虚偽が判明した場合、30日以内に新たな自己証明書を提出し、必要な税務情報を関連当局と共有することに同意します。</li>
    </ul>
  </div>
<details style="margin-top: 25px; border: 1px solid #ccc; border-radius: 8px; padding: 15px; background: #f9f9f9;">
  <summary style="cursor: pointer; font-weight: bold; color: var(--primary-color); font-size: 16px;">
    ▶ プライバシーポリシーを表示する
  </summary>
  <div style="margin-top: 15px; line-height: 1.8; font-size: 14px;">
    <h3>1. 個人情報の利用目的</h3>
    <p>
      本フォームで取得する個人情報は、以下の目的のために使用されます：<br>
      ・本人確認、KYCプロセスの実施<br>
      ・お申込み内容に基づく書類作成、商品契約手続き<br>
      ・顧客対応、アフターサポート、緊急時の連絡<br>
      ・法令に基づく記録・管理・報告の実施
    </p>

    <h3>2. 安全管理措置</h3>
    <p>
      取得した個人情報は、SSL暗号化通信による送信、アクセスログの管理、保存データの制限管理など、適切な技術的・組織的安全管理措置を講じたうえで取り扱います。
    </p>

    <h3>3. 委託・第三者提供について</h3>
    <p>
      個人情報は、業務委託先（書類作成代行、管理台帳運用等）に提供する場合がありますが、いずれも契約により適正な管理を義務付けています。<br>
      また、本人の同意がある場合または法令に基づく場合を除き、第三者への提供は行いません。
    </p>

    <h3>4. 保管および削除</h3>
    <p>
      個人情報は、契約締結後または目的達成後、法定保管期間を除き、当社の定める安全な方法により消去・破棄されます。
    </p>

    <h3>5. 開示・訂正・削除のご請求</h3>
    <p>
      ご本人からのご請求により、保有する個人情報の開示・訂正・利用停止・削除に対応いたします。ご希望の方は下記よりご連絡ください。
    </p>

    <h3>6. お問い合わせ窓口</h3>
    <p>
      個人情報の取り扱いに関するご相談・苦情は以下のサポート窓口にて承ります。<br>
      【お客様サポートLINE】<br>
      → ご利用中のLINEチャットよりお問い合わせください。<br>
      （受付時間：平日 10:00〜19:00／年末年始を除く）
    </p>

    <p style="margin-top: 10px;">制定日：2025年4月1日<br>改訂日：2025年4月19日</p>
  </div>
</details>

  <label><input type="checkbox" name="agreement" required> 上記の利用規約および宣誓内容に同意します</label>

  <div class="button-group" style="margin-top: 20px;">
    <button type="button" class="prev-btn" onclick="prevStep()">戻る</button>
    <button type="submit" class="next-btn">送信する</button>
 </div>
    </div>
  </form>
</div>

<div id="networkStatus" class="network-status"></div>

<script>
const LS_KEY = 'formData';
let currentStep = 1;
const TOTAL_STEPS = 8;

// ステップ管理
function updateStep() {
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  document.getElementById(`step${currentStep}`).classList.add('active');
  document.getElementById('current-step').textContent = currentStep;
  updateProgress();
  saveData();
}

// 進捗バー更新
function updateProgress() {
  const progress = ((currentStep - 1) / (TOTAL_STEPS - 1)) * 100;
  document.querySelector('.progress-bar').style.width = `${progress}%`;
}

// 住所自動入力
async function lookupAddress() {
  const zip = document.querySelector('[name="postcode"]').value.replace(/-/g, '');
  if (zip.length === 7) {
    try {
      const res = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${zip}`);
      const data = await res.json();
      if (data.results) {
        const addr = data.results[0];
        document.querySelector('[name="prefecture"]').value = addr.address1;
        document.querySelector('[name="city"]').value = `${addr.address2} ${addr.address3}`;
      }
    } catch (error) {
      console.error('住所取得エラー:', error);
    }
  }
}

// データ保存
async function saveData() {
  const formData = {};
  const inputs = document.querySelectorAll('input, select, textarea');
  
  for (const element of inputs) {
    if (element.type === 'file') {
      formData[element.name] = element.files[0] ? await toBase64(element.files[0]) : '';
    } else {
      formData[element.name] = element.value;
    }
  }
  
  localStorage.setItem(LS_KEY, JSON.stringify(formData));
}

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = () => resolve(reader.result);
    reader.onerror = error => reject(error);
  });
}

// データ復元
function loadData() {
  const saved = localStorage.getItem(LS_KEY);
  if (saved) {
    const data = JSON.parse(saved);
    Object.entries(data).forEach(([name, value]) => {
      const element = document.querySelector(`[name="${name}"]`);
      if (element) element.value = value;
    });
  }
}

// フォーム送信
async function handleSubmit(e) {
  e.preventDefault();
  const submitBtn = document.querySelector('button[type="submit"]');
  
  try {
    submitBtn.disabled = true;
    submitBtn.textContent = "送信中...";

    const recaptchaToken = await new Promise(resolve => {
      grecaptcha.ready(() => {
        grecaptcha.execute('6Ldt9BwrAAAAAFcxv593i86WyBKetcwrGdWecK09', {action: 'submit'}).then(resolve);
      });
    });

    const formData = new FormData(this);
    formData.append('g-recaptcha-response', recaptchaToken);

    const res = await fetch('https://script.google.com/macros/s/AKfycby0jf5b9wfSdTrIvUDCEAPNiYpDLSOvEZ5Floo-Qif6ZQJZ1b7dSGc2LVYDE1Wp8LebvA/exec', {
      method: 'POST',
      body: formData
    });

    if (res.ok) {
      localStorage.removeItem(LS_KEY);
      const msg = document.createElement('div');
      msg.className = 'success-message';
      msg.innerHTML = `
        <strong>送信が完了しました！</strong><br>
        内容を確認の上、不備がある場合は担当者よりご連絡いたします。
      `;
      document.querySelector(".container").appendChild(msg);
      document.getElementById("mainForm").style.display = "none";
    }
  } catch (error) {
    console.error('送信エラー:', error);
    alert('送信に失敗しました。再度お試しください。');
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = "送信する";
  }
}

// 初期化
function init() {
  loadData();
  updateStep();
  
  // ネットワーク監視
  const updateNetworkStatus = () => {
    const statusEl = document.getElementById('networkStatus');
    statusEl.textContent = navigator.onLine ? 'オンライン' : 'オフライン - データは自動保存されます';
    statusEl.className = `network-status ${navigator.onLine ? 'online' : 'offline'}`;
    statusEl.style.display = 'block';
    setTimeout(() => statusEl.style.display = 'none', 5000);
  };

  window.addEventListener('online', updateNetworkStatus);
  window.addEventListener('offline', updateNetworkStatus);
  updateNetworkStatus();

  // 自動保存
  document.querySelectorAll('input, select, textarea').forEach(el => {
    el.addEventListener('input', () => {
      saveData();
      validateField(el);
    });
  });

  document.getElementById('mainForm').addEventListener('submit', handleSubmit);
  setInterval(saveData, 30000);
}

function validateField(element) {
  const error = element.nextElementSibling;
  if (element.checkValidity()) {
    element.style.borderColor = '#bdc3c7';
    if (error) error.style.display = 'none';
  } else {
    element.style.borderColor = 'var(--error-color)';
    if (error) {
      error.textContent = element.validationMessage;
      error.style.display = 'block';
    }
  }
}

window.addEventListener('DOMContentLoaded', init);
window.addEventListener('beforeunload', (e) => {
  if (document.querySelectorAll(':invalid').length > 0) {
    e.preventDefault();
    e.returnValue = '';
  }
});
</script>
</body>
</html>